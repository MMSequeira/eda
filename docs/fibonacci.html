<!DOCTYPE html>

<html>
<head>
  <title>`fibonacci.c`</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
  <script src="http://softwaremaniacs.org/media/soft/highlight/highlight.pack.js"></script>
  <script>
    hljs.tabReplace = '        ';
    hljs.initHighlightingOnLoad();
  </script>
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="array_utils.html">
                array_utils.h
              </a>
            
              
              <a class="source" href="print.html">
                print.c
              </a>
            
              
              <a class="source" href="arrays_and_pointers.html">
                arrays_and_pointers.c
              </a>
            
              
              <a class="source" href="arrays_basics.html">
                arrays_basics.c
              </a>
            
              
              <a class="source" href="fibonacci.html">
                fibonacci.c
              </a>
            
              
              <a class="source" href="hello_world.html">
                hello_world.c
              </a>
            
              
              <a class="source" href="nans_and_other_oddities.html">
                nans_and_other_oddities.c
              </a>
            
              
              <a class="source" href="routine_pointers.html">
                routine_pointers.c
              </a>
            
              
              <a class="source" href="sizeof_and_arrays.html">
                sizeof_and_arrays.c
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1><code>fibonacci.c</code></h1>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class="highlight"><pre><span class="comment">/**
 * \file fibonacci.c
 * \brief Illustrates possible implementations of the calculation of terms of
 * the Fibonacci sequence.
 * 
 * Iterative and recursive implementations of the calculation of terms of
 * the Fibonacci sequence. These implementations are used to illustrate
 * iteration vs. recursion, and also to show how a naïve implementation of
 * recursion may lead to serious problems.
 */</span>
 
</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2>Coelhos, recursão e iteração</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Ofereceram ao Sr. Fibonacci um casal de coelhos, recém-nascidos, de um
espécie curiosa: tornam-se férteis ao fim de um mês de vida, concebem logo
que possível, têm uma gestação de exactamente um mês, cada ninhada consiste
sempre num casalinho de coelhos. Nunca morrem. O Sr. Fibonacci preocupou-se:
teria comida que chegue para os coelhos? Pôs-se a calcular a evolução do
número de casais de coelhos ao longo do tempo:</p>
<ol>
<li><p>No mês zero o Sr. Fibonacci vivia feliz, sem qualquer coelho. Mal
calculava o seu destino...</p>
</li>
<li><p>No primeiro mês há um casal de coelhos inférteis.</p>
</li>
<li><p>No segundo mês há um casal de coelhos, já férteis e, claro está, com a
coelha no início da gestação de mais um casalinho.</p>
</li>
<li><p>No terceiro mês há o casal de coelhos original, fértil, e já no início da
gestação de mais um casalinho de coelhos. E há, claro está, um casal recém-
nascido e, por isso, infértil. Ou seja, há dois casais de coelhos, um fértil
e outro infértil.</p>
</li>
<li><p>No quarto mês há os dois casais do mês anterior, já férteis, adicionados
de um casal recém-nascido, resultado do acasalamento do único casal fértil do
mês anterior. Ou seja, há três casais de coelhos, dois férteis e um infértil.</p>
</li>
<li><p>No quinto mês há os três casais do mês anterior, já férteis, adicionados
de dois casais recém-nascidos, resultado do acasalamento entre os dois casais
férteis do mês anterior. Ou seja, há cinco casais de coelhos, três férteis e
dois inférteis.</p>
</li>
</ol>
<p>O Sr. Fibonacci concluiu rapidamente que, a partir do terceiro mês,</p>
<ul>
<li><p>o número de casais férteis num mês é sempre igual ao número total de casais
no mês anterior e</p>
</li>
<li><p>o número total de casais num mês é sempre igual à soma do número total de
casais existente no mês anterior com o número de casais recém-nascidos, que
é igual ao número de casais férteis no mês anterior e que, por isso, é
igual ao número total de casais existentes dois meses antes.</p>
</li>
</ul>
<p>Sendo <img src="http://latex.codecogs.com/gif.latex?%5Cinline%20F_n" alt="F(n)"> o número
de casais de coelhos no mês
<img src="http://latex.codecogs.com/gif.latex?%5Cinline%20n" alt="n">, então, desde que
<img src="http://latex.codecogs.com/gif.latex?%5Cinline%20n%3E2" alt="n&gt;2">, <img src="http://latex.codecogs.com/gif.latex?%5Cinline%20F_n%3DF_%7Bn-2%7D&plus;F_%7Bn-1%7D" alt="F(n)=F(n-2)+
F(n-1)">. Quando
<img src="http://latex.codecogs.com/gif.latex?%5Cinline%20n%3D1" alt="n=1"> ou
<img src="http://latex.codecogs.com/gif.latex?%5Cinline%20n%3D2" alt="n=2">,
<img src="http://latex.codecogs.com/gif.latex?%5Cinline%20F_n%3D1" alt="F(n)=1">. Ou seja,
esta sucessão pode ser descrita de forma <em>recursiva</em>, ou seja, definindo os
termos da sucessão em função de outros termos da mesma sucessão.</p>
<p>O que pretendemos aqui é implementar uma função que receba o mês como
argumento e devolva o número de casais existentes nesse mês. Como não
fornecemos apenas uma implementação, mas várias, com diferentes eficiências,
os nomes dessas funções não poderão ser simplesmente <code>fibonacci()</code>, incluindo
no seu nome um sufixo que identifica o tipo de implementação usado. Pode
argumentar-se que, sendo a eficiência parte da interface de um módulo, então
é razoável usar esses sufixos. No entanto, seria preferível, se o nosso
objectivo não fosse o estudo dos algoritmos em si, mas a criação de
ferramentas para utilização futura ou para disponibilização a terceiros, usar
sufixos que fossem reveladores da eficiência da função, e não da sua
implementação.</p>
<p>Antes, porém, de passar às implementações, é preciso dizer que o presente
oferecido ao Sr. Fibonacci está realmente envenenado. Com efeito, a sequência
de Fibonacci cresce de forma extremamente rápida. Assim, no mês 120, ou seja,
dez anos depois da oferta do casal original, o número de casais a alimentar é
exactamente 5&thinsp;358&thinsp;359&thinsp;254&thinsp;990&thinsp;966&thinsp;640&thinsp;871&thinsp;840.
Este valor é demasiado grande para os <code>int</code> nas nossas máquinas habituais,
que têm 32 <em>bits</em>, ou mesmo para os <em>long</em>, com 64 <em>bits</em> nessas mesmas
máquinas. Por outro lado, a precisão limitada dos tipos de virgula flutuante
pode pôr problemas complicados ao cálculo dos termos da sequência (já
tínhamos dito que dos tipos de vírgula flutuante se foge como diabo da
cruz?). O código abaixo recorre ao tipo <code>long</code>, numa tentativa de evitar que
se atinjam muito cedo os limites dos inteiros. É uma ná solução, no entanto.
Uma boa solução passaria pela utilização de um tipo capaz de representar
números inteiros de dimensão arbitrária (desde que haja memória para o
guardar, bem entendido). A implementação de um tal tipo é um excelente
exercício de algoritmos e estruturas de dados, mas não o resolveremos aqui.</p>
<h2>Implementação</h2>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h3>Inclusão de ficheiros de cabeçalho</h3>
<p>Incluímos os seguintes ficheiros de cabeçalho:</p>
<ul>
<li><p><code>stdio.h</code> &ndash; Para declaração do procedimento <code>printf()</code>.</p>
</li>
<li><p><code>stdlib.h</code> &ndash; Para definição da <em>macro</em> <code>EXIT_SUCCESS</code>.</p>
</li>
<li><p><code>time.h</code> &ndash; Para definição da função <code>clock()</code> e da macro
<code>CLOCKS_PER_SEC</code>.</p>
</li>
<li><p><code>assert.h</code> &ndash; Para definição da macro <code>assert()</code>.</p>
</li>
</ul>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;time.h&gt;</span>
<span class="preprocessor">#include &lt;assert.h&gt;</span>

</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h3>Implementação recursiva «estúpida»</h3>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4>Documentação</h4>
<p>A documentação da função é feita no formato do
<a href="http://doxygen.org/">Doxygen</a>, como habitualmente.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="comment">/** \brief Returns the `n`th term of the Fiboncci sequence.
 *
 * \param n The number of the term to return (first valid value is 0).
 * \return The value of the `n`th term of the Fibonacci sequence. The time taken
 * by the function grows exponentially with `n`.
 * \pre `n` ≥ 0
 * \post result = \f$F_{\mathtt{n}}\f$
 *
 * Returns the `n`th term of the Fibonacci sequence. It is assumed the sequence
 * starts at `n` = 0, with value 0, followed by value 1, at `n` = 1. That is,
 * the sequence is defined by
 * \f[
 * F_n = \left\{\begin{array}{ll}
 *     0                 &amp; \text{if } n=0, \\ 
 *     1                 &amp; \text{if } n=1\text{, and} \\ 
 *     F_{n-2} + F_{n-1} &amp; \text{if } n&gt;1.
 *   \end{array}\right.
 * \f]
 */</span>
</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h4>Definição</h4>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="keyword">long</span> stupidly_recursive_fibonacci(<span class="keyword">int</span> n)
{
	assert(n &gt;= <span class="number">0</span>);

	<span class="keyword">if</span> (n == <span class="number">0</span>)
		<span class="keyword">return</span> <span class="number">0L</span>;
	<span class="keyword">if</span> (n == <span class="number">1</span>)
		<span class="keyword">return</span> <span class="number">1L</span>;

	<span class="keyword">return</span> stupidly_recursive_fibonacci(n - <span class="number">2</span>)
		+ stupidly_recursive_fibonacci(n - <span class="number">1</span>);
}

</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h3>Implementação iterativa</h3>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h4>Documentação</h4>
<p>A documentação da função é feita no formato do
<a href="http://doxygen.org/">Doxygen</a>, como habitualmente.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="comment">/** \brief Returns the `n`th term of the Fiboncci sequence.
 *
 * \param n The number of the term to return (first valid value is 0).
 * \return The value of the `n`th term of the Fibonacci sequence. The time taken
 * by the function grows linearly with `n`. 
 * \pre `n` ≥ 0
 * \post result = \f$F_{\mathtt{n}}\f$
 *
 * Returns the `n`th term of the Fibonacci sequence. It is assumed the sequence
 * starts at `n` = 0, with value 0, followed by value 1, at `n` = 1. That is,
 * the sequence is defined by
 * \f[
 * F_n = \left\{\begin{array}{ll}
 *     0                 &amp; \text{if } n=0, \\ 
 *     1                 &amp; \text{if } n=1\text{, and} \\ 
 *     F_{n-2} + F_{n-1} &amp; \text{if } n&gt;1.
 *   \end{array}\right.
 * \f]
 */</span>
</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h4>Definição</h4>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="keyword">long</span> iterative_fibonacci(<span class="keyword">int</span> n)
{
	assert(n &gt;= <span class="number">0</span>);

	<span class="keyword">if</span> (n == <span class="number">0</span>)
		<span class="keyword">return</span> <span class="number">0L</span>;
	<span class="keyword">if</span> (n == <span class="number">1</span>)
		<span class="keyword">return</span> <span class="number">1L</span>;

	<span class="keyword">long</span> previous_term = <span class="number">1L</span>;
	<span class="keyword">long</span> current_term = <span class="number">1L</span>;
	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>; i != n; i++) {
		current_term += previous_term;
		previous_term = current_term - previous_term;
	}

	<span class="keyword">return</span> current_term;
}

</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h3>Procedimento !!!!!!!</h3>

            </div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h4>Documentação</h4>
<p>!!!!!!!!</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="comment">/** \brief !!!!!!!!!!!! (includes month 0)
 *
 * \param n !!!!!!!!!
 * \return !!!!!!!!!!!
 * \pre `n` ≥ 0
 * \post !!!
 *
 * !!!!!!!!!!!!!!!
 */</span>
</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h4>Definição</h4>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="keyword">void</span> experiment_efficiency_of(<span class="keyword">char</span> title[], <span class="keyword">long</span> fibonacci(<span class="keyword">int</span>),
			<span class="keyword">int</span> last_term)
{
	printf(<span class="string">"%s\n"</span>, title);
	<span class="keyword">double</span> previous_time = <span class="number">0.0</span>;
	<span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">0</span>; n != last_term + <span class="number">1</span>; n++) {
		clock_t start = clock();
		<span class="keyword">int</span> f = fibonacci(n);
		clock_t end = clock();
		<span class="keyword">double</span> time = (<span class="keyword">double</span>) (end - start) / CLOCKS_PER_SEC;
		printf(<span class="string">"f(%d) = %d in %.4fs %g\n"</span>, n, f, time,
			time / previous_time);
		previous_time = time;
	}
}

</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h3>Procedimento !!!!!!!</h3>
<p>!!!!!!!!</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="keyword">int</span> main(<span class="keyword">void</span>)
{
	<span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">0</span>; n != <span class="number">11</span>; n++) {
		printf(<span class="string">"F(%d) [stupid recursive] = %ld\n"</span>, n, stupidly_recursive_fibonacci(n));
		printf(<span class="string">"F(%d) [iterative] = %ld\n"</span>, n, iterative_fibonacci(n));
	}

	<span class="keyword">return</span> EXIT_SUCCESS;

	experiment_efficiency_of(<span class="string">"Stupidly recursive implementation of the fibonacci sequence:"</span>,
				stupidly_recursive_fibonacci, <span class="number">35</span>);
	experiment_efficiency_of(<span class="string">"Three variable iterative implementation of the fibonacci sequence:"</span>,
				iterative_fibonacci, <span class="number">1000</span>);

	<span class="keyword">return</span> EXIT_SUCCESS;
}

</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
